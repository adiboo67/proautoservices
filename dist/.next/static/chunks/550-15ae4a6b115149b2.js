"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[550],{6530:function(e,s,r){r.d(s,{Z:function(){return n}});var t=r(5893),l=r(7294),a=r(1163),i=r(9008);function n(e){let{children:s,allowedRoles:r}=e,n=(0,a.useRouter)(),[o,c]=(0,l.useState)(!0);async function d(){try{let{data:{session:e}}=await i.O.auth.getSession();if(!e){n.push("/auth/login");return}if(r){let{data:s}=await i.O.from("users").select("role").eq("id",e.user.id).single();if(!s||!r.includes(s.role)){n.push("/");return}}}catch(e){console.error("Error checking auth:",e),n.push("/auth/login")}finally{c(!1)}}return((0,l.useEffect)(()=>{d()},[]),o)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):(0,t.jsx)(t.Fragment,{children:s})}},4645:function(e,s,r){r.d(s,{Z:function(){return c}});var t=r(5893),l=r(7294),a=r(1163),i=r(9008),n=r(2920);function o(){return(0,t.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,t.jsx)("img",{src:"/images/mechanic-duck.png.png",alt:"M\xe9canicien",className:"w-48 h-48 object-contain",style:{maxWidth:"100%",height:"auto"}})})}function c(e){let{children:s,title:r}=e,c=(0,a.useRouter)(),[d,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{let{data:{user:e}}=await i.O.auth.getUser();if(e){let{data:s,error:r}=await i.O.from("users").select("full_name").eq("id",e.id).single();s&&s.full_name?x(s.full_name):x(e.email||null)}})()},[]);let h=async()=>{try{let{error:e}=await i.O.auth.signOut();if(e)throw e;c.push("/auth/login"),n.Am.success("D\xe9connexion r\xe9ussie")}catch(e){n.Am.error("Erreur lors de la d\xe9connexion"),console.error("Error:",e)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("div",{className:"fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ".concat(d?"translate-x-0":"-translate-x-full"," lg:translate-x-0 transition-transform duration-200 ease-in-out"),children:(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"flex items-center justify-center h-16 px-4 bg-blue-600",children:(0,t.jsx)("h2",{className:"text-xl font-semibold text-white",children:"ProAutoServices"})}),(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50",children:(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Bonjour ",m]})}),(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(o,{})}),(0,t.jsx)("nav",{className:"flex-1 px-4 py-4 space-y-1"}),(0,t.jsx)("div",{className:"p-4 border-t",children:(0,t.jsx)("button",{onClick:h,className:"w-full px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"D\xe9connexion"})})]})}),(0,t.jsxs)("div",{className:"lg:pl-64",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between h-16 px-4 bg-white shadow-sm",children:[(0,t.jsx)("button",{onClick:()=>u(!d),className:"p-2 text-gray-500 lg:hidden",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,t.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:r}),(0,t.jsx)("div",{className:"w-6 lg:hidden"})," "]}),(0,t.jsx)("main",{className:"p-4",children:s})]})]})}},1915:function(e,s,r){r.d(s,{Z:function(){return c}});var t=r(5893),l=r(7294),a=r(5675),i=r.n(a),n=r(9008),o=r(2920);function c(e){let{imageUrl:s,onUpload:r,onDelete:a,index:c}=e,[d,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null);(0,l.useEffect)(()=>{s&&x(null)},[s]);let h=async e=>{try{var s;if(u(!0),!e.target.files||0===e.target.files.length)throw Error("Veuillez s\xe9lectionner une image");let t=e.target.files[0],l=(null===(s=t.name.split(".").pop())||void 0===s?void 0:s.toLowerCase())||"";if(!["jpg","jpeg","png","gif"].includes(l))throw Error("Format de fichier non support\xe9. Utilisez JPG, PNG ou GIF");if(t.size>5242880)throw Error("La taille du fichier ne doit pas d\xe9passer 5MB");let a="".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9),".").concat(l),i=new FileReader;i.onloadend=()=>{x(i.result)},i.readAsDataURL(t);let{error:o,data:c}=await n.O.storage.from("vehicle-photos").upload(a,t,{cacheControl:"3600",upsert:!1,contentType:"image/".concat("jpg"===l?"jpeg":l)});if(o)throw console.error("Upload error details:",o),Error(o.message);if(null==c?void 0:c.path){let{data:e}=n.O.storage.from("vehicle-photos").getPublicUrl(a);if(null==e?void 0:e.publicUrl)r(e.publicUrl);else throw Error("Erreur lors de la r\xe9cup\xe9ration de l'URL publique")}else throw Error("Erreur lors du t\xe9l\xe9chargement du fichier")}catch(e){console.error("Upload error:",e),o.Am.error(e.message||"Erreur lors du t\xe9l\xe9chargement"),x(null)}finally{u(!1)}},p=async()=>{if(a)try{if(s){let e=s.split("/").pop();if(e){let{error:s}=await n.O.storage.from("vehicle-photos").remove([e]);if(s)throw console.error("Error deleting file:",s),Error("Erreur lors de la suppression du fichier")}}x(null),a()}catch(e){console.error("Error in handleDelete:",e),o.Am.error(e.message||"Erreur lors de la suppression de l'image")}},f=s||m;return(0,t.jsx)("div",{className:"relative w-full h-40 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 hover:border-gray-400 transition-colors",children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i(),{src:f,alt:"Photo ".concat(c+1),fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-contain p-2 rounded-lg",unoptimized:null!==m,priority:0===c}),(0,t.jsx)("button",{onClick:p,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition-colors z-10",type:"button",title:"Supprimer la photo",children:"\xd7"})]}):(0,t.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-full cursor-pointer",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,t.jsx)("svg",{className:"w-8 h-8 mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Photo ",c+1]}),d&&(0,t.jsx)("div",{className:"mt-2 text-sm text-blue-500",children:"Chargement..."})]}),(0,t.jsx)("input",{type:"file",className:"hidden",accept:"image/jpeg,image/png,image/gif",onChange:h,disabled:d})]})})}},7318:function(e,s,r){r.d(s,{Z:function(){return o}});var t=r(5893),l=r(7294),a=r(8877),i=r.n(a),n=r(6501);function o(e){let{onSave:s=()=>{},existingSignature:r}=e,a=(0,l.useRef)(null),[o,c]=(0,l.useState)(!!r);return(0,t.jsx)("div",{className:"space-y-4",children:o&&r?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("img",{src:r,alt:"Signature existante",className:"border rounded-lg p-2 bg-white"}),(0,t.jsx)("button",{onClick:()=>c(!1),className:"text-sm text-blue-600 hover:text-blue-800",children:"Modifier la signature"})]}):(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"border rounded-lg bg-white",children:(0,t.jsx)(i(),{ref:a,canvasProps:{className:"signature-canvas w-full h-40"}})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)("button",{onClick:()=>{var e;null===(e=a.current)||void 0===e||e.clear()},className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Effacer"}),(0,t.jsx)("button",{onClick:()=>{var e,r;if(null===(e=a.current)||void 0===e?void 0:e.isEmpty()){n.ZP.error("Veuillez signer avant de sauvegarder");return}let t=null===(r=a.current)||void 0===r?void 0:r.toDataURL();t&&s&&(s(t),n.ZP.success("Signature enregistr\xe9e"))},className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700",children:"Sauvegarder"})]})]})})}},5823:function(e,s,r){r.d(s,{Z:function(){return u}});var t=r(5893),l=r(7294),a=r(9008),i=r(2920),n=r(7536),o=r(7318),c=r(1915);function d(e){var s;let{vehicle:r,onClose:d,onSuccess:u}=e,[m,x]=(0,l.useState)(!1),[h,p]=(0,l.useState)(""),[f,b]=(0,l.useState)([]),[g,v]=(0,l.useState)((null==r?void 0:null===(s=r.mechanics)||void 0===s?void 0:s.map(e=>e.toString()))||[]),[j,y]=(0,l.useState)([]),{register:w,handleSubmit:N,setValue:k,formState:{errors:_}}=(0,n.cI)({defaultValues:{client_name:(null==r?void 0:r.client_name)||"",address:(null==r?void 0:r.address)||"",phone:(null==r?void 0:r.phone)||"",brand_model:(null==r?void 0:r.brand_model)||"",mileage:(null==r?void 0:r.mileage)||void 0,work_type:(null==r?void 0:r.work_type)||"",parts_supplies:(null==r?void 0:r.parts_supplies)||"",entry_date:(null==r?void 0:r.entry_date)||"",exit_date:(null==r?void 0:r.exit_date)||"",observations:(null==r?void 0:r.observations)||"",registration_number:(null==r?void 0:r.registration_number)||"",status:(null==r?void 0:r.status)||"pending",mechanics:[]}});(0,l.useEffect)(()=>{E(),y([,,,,].fill("").map((e,s)=>{var t;return(null==r?void 0:null===(t=r.photos)||void 0===t?void 0:t[s])||""})),r&&Object.entries(r).forEach(e=>{let[s,r]=e;"mechanics"!==s&&"photos"!==s&&"client_signature"!==s&&k(s,r)})},[r,k]);let E=async()=>{try{let{data:e,error:s}=await a.O.from("mechanics").select("id, name").order("name");if(s)throw s;console.log("Mechanics fetched:",e),b(e||[])}catch(e){console.error("Error fetching mechanics:",e),i.Am.error("Erreur lors du chargement des m\xe9caniciens")}},C=(e,s)=>{let r=[...j];r[e]=s,y(r)},S=e=>{let s=[...j];s[e]="",y(s)},M=async e=>{try{x(!0);let s=g.map(e=>parseInt(e,10));console.log("Mechanic IDs before save:",s);let t={client_name:e.client_name,address:e.address,phone:e.phone,brand_model:e.brand_model,mileage:e.mileage,work_type:e.work_type,parts_supplies:e.parts_supplies,entry_date:e.entry_date,exit_date:e.exit_date,observations:e.observations,registration_number:e.registration_number,status:e.status,mechanics:s,client_signature:h,photos:j.filter(Boolean)};console.log("Vehicle data before cleanup:",t);let l=Object.fromEntries(Object.entries(t).filter(e=>{let[s,r]=e;return Array.isArray(r)?r.length>0:void 0!==r&&""!==r&&null!==r}));console.log("Clean data before save:",l),console.log("Update query:",{table:"vehicles",data:l,id:null==r?void 0:r.id});let{data:n,error:o}=(null==r?void 0:r.id)?await a.O.from("vehicles").update(l).eq("id",r.id):await a.O.from("vehicles").insert(l).select();if(o)throw console.error("Supabase error:",o),o;console.log("Update response:",n),i.Am.success(r?"V\xe9hicule modifi\xe9 avec succ\xe8s":"V\xe9hicule ajout\xe9 avec succ\xe8s"),u()}catch(e){console.error("Error saving vehicle:",e),i.Am.error(r?"Erreur lors de la modification du v\xe9hicule":"Erreur lors de l'ajout du v\xe9hicule")}finally{x(!1)}};return(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4",children:(0,t.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:r?"Modifier le v\xe9hicule":"Ajouter un v\xe9hicule"}),(0,t.jsxs)("form",{onSubmit:N(M),className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nom du client"}),(0,t.jsx)("input",{type:"text",...w("client_name",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),_.client_name&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:_.client_name.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Adresse"}),(0,t.jsx)("input",{type:"text",...w("address"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"T\xe9l\xe9phone"}),(0,t.jsx)("input",{type:"text",...w("phone",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),_.phone&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:_.phone.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Marque et Mod\xe8le"}),(0,t.jsx)("input",{type:"text",...w("brand_model",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),_.brand_model&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:_.brand_model.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Kilom\xe9trage"}),(0,t.jsx)("input",{type:"number",...w("mileage"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Immatriculation"}),(0,t.jsx)("input",{type:"text",...w("registration_number",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),_.registration_number&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:_.registration_number.message})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Type de travaux"}),(0,t.jsx)("input",{type:"text",...w("work_type",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),_.work_type&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:_.work_type.message})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Pi\xe8ces et fournitures"}),(0,t.jsx)("textarea",{...w("parts_supplies"),rows:3,className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Date d'entr\xe9e"}),(0,t.jsx)("input",{type:"date",...w("entry_date",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),_.entry_date&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:_.entry_date.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Date de sortie pr\xe9vue"}),(0,t.jsx)("input",{type:"date",...w("exit_date"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Statut"}),(0,t.jsxs)("select",{...w("status"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2",children:[(0,t.jsx)("option",{value:"pending",children:"En attente"}),(0,t.jsx)("option",{value:"in_progress",children:"En cours"}),(0,t.jsx)("option",{value:"done",children:"Termin\xe9"}),(0,t.jsx)("option",{value:"validated",children:"Valid\xe9"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"M\xe9caniciens"}),(0,t.jsx)("select",{multiple:!0,value:g,onChange:e=>{v(Array.from(e.target.selectedOptions,e=>e.value))},className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2",size:4,children:f.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Maintenez Ctrl (ou Cmd sur Mac) pour s\xe9lectionner plusieurs m\xe9caniciens"})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Observations"}),(0,t.jsx)("textarea",{...w("observations"),rows:3,className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Photos du v\xe9hicule"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:j.map((e,s)=>(0,t.jsx)(c.Z,{index:s,imageUrl:e,onUpload:e=>C(s,e),onDelete:()=>S(s)},"".concat(s,"-").concat(e)))}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Vous pouvez ajouter jusqu'\xe0 4 photos du v\xe9hicule"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Signature du client"}),(0,t.jsx)(o.Z,{existingSignature:h,onSave:e=>p(e)})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Annuler"}),(0,t.jsx)("button",{type:"submit",disabled:m,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:m?"Enregistrement...":r?"Modifier":"Ajouter"})]})]})]})})})}function u(){let[e,s]=(0,l.useState)([]),[r,n]=(0,l.useState)(!0),[o,c]=(0,l.useState)(!1),[u,m]=(0,l.useState)(null),[x,h]=(0,l.useState)("");(0,l.useEffect)(()=>{p()},[]);let p=async()=>{try{let{data:e,error:r}=await a.O.from("vehicles").select("*").order("entry_date",{ascending:!1});if(r)throw r;let{data:t,error:l}=await a.O.from("mechanics").select("id, name");if(l)throw l;let i=new Map(t.map(e=>[e.id,e])),n=e.map(e=>({...e,mechanicsList:Array.isArray(e.mechanics)?e.mechanics.map(e=>{var s;return null===(s=i.get(e))||void 0===s?void 0:s.name}).filter(Boolean).join(", "):""}));s(n||[])}catch(e){console.error("Error fetching vehicles:",e),i.Am.error("Erreur lors du chargement des v\xe9hicules")}finally{n(!1)}},f=e.filter(e=>{var s,r,t,l;let a=x.toLowerCase();return(null===(s=e.client_name)||void 0===s?void 0:s.toLowerCase().includes(a))||(null===(r=e.brand_model)||void 0===r?void 0:r.toLowerCase().includes(a))||(null===(t=e.registration_number)||void 0===t?void 0:t.toLowerCase().includes(a))||(null===(l=e.work_type)||void 0===l?void 0:l.toLowerCase().includes(a))}),b=e=>{m(e),c(!0)},g=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer ce v\xe9hicule ?"))try{let{error:s}=await a.O.from("vehicles").delete().eq("id",e);if(s)throw s;i.Am.success("V\xe9hicule supprim\xe9 avec succ\xe8s"),p()}catch(e){console.error("Error deleting vehicle:",e),i.Am.error("Erreur lors de la suppression du v\xe9hicule")}},v=e=>{switch(e){case"pending":return"En attente";case"in_progress":return"En cours";case"done":return"Termin\xe9";case"validated":return"Valid\xe9";default:return e}},j=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"in_progress":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"validated":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return r?(0,t.jsx)("div",{children:"Chargement..."}):(0,t.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8",children:[(0,t.jsxs)("div",{className:"sm:flex sm:items-center",children:[(0,t.jsxs)("div",{className:"sm:flex-auto",children:[(0,t.jsx)("h1",{className:"text-base font-semibold leading-6 text-gray-900",children:"Fiches V\xe9hicules"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-700",children:"Liste des v\xe9hicules en r\xe9paration"})]}),(0,t.jsx)("div",{className:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none",children:(0,t.jsx)("button",{onClick:()=>{m(null),c(!0)},type:"button",className:"block rounded-md bg-blue-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",children:"Ajouter une fiche"})})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[(0,t.jsx)("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Rechercher par nom, mod\xe8le, immatriculation...",className:"block w-full rounded-md border-gray-300 pl-4 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),(0,t.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]})}),(0,t.jsx)("div",{className:"mt-8 flow-root",children:(0,t.jsx)("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,t.jsx)("div",{className:"inline-block min-w-full py-2 align-middle",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-300",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6 lg:pl-8",children:"Client"}),(0,t.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"V\xe9hicule"}),(0,t.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Immatriculation"}),(0,t.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Statut"}),(0,t.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"M\xe9caniciens"}),(0,t.jsx)("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6 lg:pr-8",children:(0,t.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:r?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"text-center py-4",children:"Chargement..."})}):0===f.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:x?"Aucun v\xe9hicule ne correspond \xe0 votre recherche":"Aucun v\xe9hicule enregistr\xe9"})}):f.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 lg:pl-8",children:e.client_name}),(0,t.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.brand_model}),(0,t.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.registration_number||"-"}),(0,t.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm",children:(0,t.jsx)("span",{className:"inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ".concat(j(e.status)),children:v(e.status)})}),(0,t.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.mechanicsList||"-"}),(0,t.jsxs)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 lg:pr-8",children:[(0,t.jsx)("button",{onClick:()=>b(e),className:"text-blue-600 hover:text-blue-900 mr-4",children:"Modifier"}),(0,t.jsx)("button",{onClick:()=>g(e.id),className:"text-red-600 hover:text-red-900",children:"Supprimer"})]})]},e.id))})]})})})}),o&&(0,t.jsx)(d,{vehicle:u,onClose:()=>c(!1),onSuccess:()=>{c(!1),p()}})]})}},9008:function(e,s,r){r.d(s,{O:function(){return t}});let t=(0,r(6490).eI)("https://pjxtjkmqgkbisgfleaps.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqeHRqa21xZ2tiaXNnZmxlYXBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYxOTAzMzAsImV4cCI6MjA1MTc2NjMzMH0.UjKK4kSJDapIRx0iJvdHiJZzMbi99tDx52FmSq4qyfE",{auth:{persistSession:!0,autoRefreshToken:!0}})}}]);