(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{6659:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/register",function(){return r(3755)}])},9008:function(e,s,r){"use strict";r.d(s,{O:function(){return a}});let a=(0,r(6490).eI)("https://pjxtjkmqgkbisgfleaps.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqeHRqa21xZ2tiaXNnZmxlYXBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYxOTAzMzAsImV4cCI6MjA1MTc2NjMzMH0.UjKK4kSJDapIRx0iJvdHiJZzMbi99tDx52FmSq4qyfE",{auth:{persistSession:!0,autoRefreshToken:!0}})},3755:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return c}});var a=r(5893),l=r(7294),t=r(1163),o=r(7536),i=r(9008);function n(e){let{children:s,title:r}=e;return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:(0,a.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:r})}),(0,a.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:(0,a.jsx)("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:s})})]})}var d=r(2920);function c(){let e=(0,t.useRouter)(),[s,r]=(0,l.useState)(!1),{register:c,handleSubmit:m,watch:u,formState:{errors:p}}=(0,o.cI)(),x=u("password"),f=async s=>{try{var a;r(!0);let{data:{session:l}}=await i.O.auth.getSession();if(!l){d.Am.error("Vous devez \xeatre connect\xe9 en tant qu'administrateur"),e.push("/auth/login");return}let{data:t}=await i.O.from("users").select("role").eq("id",l.user.id).single();if((null==t?void 0:t.role)!=="admin"){d.Am.error("Acc\xe8s non autoris\xe9"),e.push("/");return}let{error:o,data:n}=await i.O.auth.signUp({email:s.email,password:s.password});if(o)throw o;let{error:c}=await i.O.from("users").insert([{id:null===(a=n.user)||void 0===a?void 0:a.id,email:s.email,full_name:s.fullName,role:s.role}]);if(c)throw c;d.Am.success("Utilisateur cr\xe9\xe9 avec succ\xe8s!"),e.push("/admin/dashboard")}catch(e){d.Am.error("Erreur lors de la cr\xe9ation du compte"),console.error("Error:",e)}finally{r(!1)}};return(0,a.jsx)(n,{title:"Cr\xe9er un nouveau compte",children:(0,a.jsxs)("form",{className:"space-y-6",onSubmit:m(f),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700",children:"Nom complet"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("input",{id:"fullName",type:"text",...c("fullName",{required:"Nom complet requis"}),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),p.fullName&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.fullName.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Adresse email"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("input",{id:"email",type:"email",...c("email",{required:"Email requis",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Email invalide"}}),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),p.email&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.email.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700",children:"R\xf4le"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsxs)("select",{id:"role",...c("role",{required:"R\xf4le requis"}),className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"secretary",children:"Secr\xe9taire"}),(0,a.jsx)("option",{value:"mechanic",children:"M\xe9canicien"})]}),p.role&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.role.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Mot de passe"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("input",{id:"password",type:"password",...c("password",{required:"Mot de passe requis",minLength:{value:8,message:"Le mot de passe doit contenir au moins 8 caract\xe8res"}}),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),p.password&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.password.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirmer le mot de passe"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("input",{id:"confirmPassword",type:"password",...c("confirmPassword",{required:"Veuillez confirmer le mot de passe",validate:e=>e===x||"Les mots de passe ne correspondent pas"}),className:"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500"}),p.confirmPassword&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:p.confirmPassword.message})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:s,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:s?"Cr\xe9ation...":"Cr\xe9er le compte"})})]})})}}},function(e){e.O(0,[574,536,774,888,179],function(){return e(e.s=6659)}),_N_E=e.O()}]);