(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{8813:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vehicles/[id]",function(){return t(6957)}])},6530:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});var i=t(5893),n=t(7294),a=t(1163),r=t(9008);function l(e){let{children:s,allowedRoles:t}=e,l=(0,a.useRouter)(),[c,d]=(0,n.useState)(!0);async function u(){try{let{data:{session:e}}=await r.O.auth.getSession();if(!e){l.push("/auth/login");return}if(t){let{data:s}=await r.O.from("users").select("role").eq("id",e.user.id).single();if(!s||!t.includes(s.role)){l.push("/");return}}}catch(e){console.error("Error checking auth:",e),l.push("/auth/login")}finally{d(!1)}}return((0,n.useEffect)(()=>{u()},[]),c)?(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):(0,i.jsx)(i.Fragment,{children:s})}},4645:function(e,s,t){"use strict";t.d(s,{Z:function(){return d}});var i=t(5893),n=t(7294),a=t(1163),r=t(9008),l=t(2920);function c(){return(0,i.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,i.jsx)("img",{src:"/images/mechanic-duck.png.png",alt:"M\xe9canicien",className:"w-48 h-48 object-contain",style:{maxWidth:"100%",height:"auto"}})})}function d(e){let{children:s,title:t}=e,d=(0,a.useRouter)(),[u,o]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{let{data:{user:e}}=await r.O.auth.getUser();if(e){let{data:s,error:t}=await r.O.from("users").select("full_name").eq("id",e.id).single();s&&s.full_name?x(s.full_name):x(e.email||null)}})()},[]);let h=async()=>{try{let{error:e}=await r.O.auth.signOut();if(e)throw e;d.push("/auth/login"),l.Am.success("D\xe9connexion r\xe9ussie")}catch(e){l.Am.error("Erreur lors de la d\xe9connexion"),console.error("Error:",e)}};return(0,i.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,i.jsx)("div",{className:"fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ".concat(u?"translate-x-0":"-translate-x-full"," lg:translate-x-0 transition-transform duration-200 ease-in-out"),children:(0,i.jsxs)("div",{className:"flex flex-col h-full",children:[(0,i.jsx)("div",{className:"flex items-center justify-center h-16 px-4 bg-blue-600",children:(0,i.jsx)("h2",{className:"text-xl font-semibold text-white",children:"ProAutoServices"})}),(0,i.jsx)("div",{className:"px-4 py-3 bg-gray-50",children:(0,i.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Bonjour ",m]})}),(0,i.jsx)("div",{className:"flex-shrink-0",children:(0,i.jsx)(c,{})}),(0,i.jsx)("nav",{className:"flex-1 px-4 py-4 space-y-1"}),(0,i.jsx)("div",{className:"p-4 border-t",children:(0,i.jsx)("button",{onClick:h,className:"w-full px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"D\xe9connexion"})})]})}),(0,i.jsxs)("div",{className:"lg:pl-64",children:[(0,i.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between h-16 px-4 bg-white shadow-sm",children:[(0,i.jsx)("button",{onClick:()=>o(!u),className:"p-2 text-gray-500 lg:hidden",children:(0,i.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,i.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:t}),(0,i.jsx)("div",{className:"w-6 lg:hidden"})," "]}),(0,i.jsx)("main",{className:"p-4",children:s})]})]})}},7318:function(e,s,t){"use strict";t.d(s,{Z:function(){return c}});var i=t(5893),n=t(7294),a=t(8877),r=t.n(a),l=t(6501);function c(e){let{onSave:s=()=>{},existingSignature:t}=e,a=(0,n.useRef)(null),[c,d]=(0,n.useState)(!!t);return(0,i.jsx)("div",{className:"space-y-4",children:c&&t?(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("img",{src:t,alt:"Signature existante",className:"border rounded-lg p-2 bg-white"}),(0,i.jsx)("button",{onClick:()=>d(!1),className:"text-sm text-blue-600 hover:text-blue-800",children:"Modifier la signature"})]}):(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("div",{className:"border rounded-lg bg-white",children:(0,i.jsx)(r(),{ref:a,canvasProps:{className:"signature-canvas w-full h-40"}})}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,i.jsx)("button",{onClick:()=>{var e;null===(e=a.current)||void 0===e||e.clear()},className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Effacer"}),(0,i.jsx)("button",{onClick:()=>{var e,t;if(null===(e=a.current)||void 0===e?void 0:e.isEmpty()){l.ZP.error("Veuillez signer avant de sauvegarder");return}let i=null===(t=a.current)||void 0===t?void 0:t.toDataURL();i&&s&&(s(i),l.ZP.success("Signature enregistr\xe9e"))},className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700",children:"Sauvegarder"})]})]})})}},9008:function(e,s,t){"use strict";t.d(s,{O:function(){return i}});let i=(0,t(6490).eI)("https://pjxtjkmqgkbisgfleaps.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqeHRqa21xZ2tiaXNnZmxlYXBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYxOTAzMzAsImV4cCI6MjA1MTc2NjMzMH0.UjKK4kSJDapIRx0iJvdHiJZzMbi99tDx52FmSq4qyfE",{auth:{persistSession:!0,autoRefreshToken:!0}})},6957:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var i=t(5893),n=t(7294),a=t(1163),r=t(9008),l=t(4645),c=t(6530),d=t(7318),u=t(6501);function o(){let{id:e}=(0,a.useRouter)().query,[s,t]=(0,n.useState)(null);(0,n.useEffect)(()=>{e&&o()},[e]);let o=async()=>{try{let{data:s,error:i}=await r.O.from("vehicles").select("*").eq("id",e).single();if(i)throw i;t(s)}catch(e){u.ZP.error(e.message)}},m=async s=>{try{if(!e)return;let{error:t}=await r.O.from("vehicles").update({client_signature:s}).eq("id",e);if(t)throw t;u.ZP.success("Signature enregistr\xe9e")}catch(e){u.ZP.error(e.message)}};return s?(0,i.jsx)(c.Z,{allowedRoles:["secretary"],children:(0,i.jsx)(l.Z,{title:"V\xe9hicule - ".concat(s.brand_model),children:(0,i.jsx)("div",{className:"py-6",children:(0,i.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,i.jsx)("div",{className:"bg-white shadow rounded-lg",children:(0,i.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Informations client"}),(0,i.jsxs)("dl",{className:"mt-2 text-sm text-gray-500",children:[(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("dt",{className:"font-medium",children:"Nom"}),(0,i.jsx)("dd",{children:s.client_name})]}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("dt",{className:"font-medium",children:"Adresse"}),(0,i.jsx)("dd",{children:s.client_address})]}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("dt",{className:"font-medium",children:"T\xe9l\xe9phone"}),(0,i.jsx)("dd",{children:s.phone})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Informations v\xe9hicule"}),(0,i.jsxs)("dl",{className:"mt-2 text-sm text-gray-500",children:[(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("dt",{className:"font-medium",children:"Marque et mod\xe8le"}),(0,i.jsx)("dd",{children:s.brand_model})]}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("dt",{className:"font-medium",children:"Kilom\xe9trage"}),(0,i.jsxs)("dd",{children:[s.mileage," km"]})]}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("dt",{className:"font-medium",children:"Date d'entr\xe9e"}),(0,i.jsx)("dd",{children:new Date(s.entry_date).toLocaleDateString()})]}),(0,i.jsxs)("div",{className:"mt-1",children:[(0,i.jsx)("dt",{className:"font-medium",children:"Statut"}),(0,i.jsx)("dd",{className:"capitalize",children:s.status.replace("_"," ")})]})]})]})]}),(0,i.jsxs)("div",{className:"mt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Description des travaux"}),(0,i.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:s.work_description})]}),(0,i.jsxs)("div",{className:"mt-6",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Signature du client"}),(0,i.jsx)(d.Z,{onSave:m,existingSignature:s.signature})]})]})})})})})}):null}}},function(e){e.O(0,[574,653,774,888,179],function(){return e(e.s=8813)}),_N_E=e.O()}]);