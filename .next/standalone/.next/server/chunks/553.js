"use strict";exports.id=553,exports.ids=[553],exports.modules={7318:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{Z:()=>d});var a=t(997),l=t(6689),i=t(8784),o=t.n(i),c=t(6201),n=e([c]);function d({onSave:e=()=>{},existingSignature:s}){let t=(0,l.useRef)(null),[r,i]=(0,l.useState)(!!s);return a.jsx("div",{className:"space-y-4",children:r&&s?(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("img",{src:s,alt:"Signature existante",className:"border rounded-lg p-2 bg-white"}),a.jsx("button",{onClick:()=>i(!1),className:"text-sm text-blue-600 hover:text-blue-800",children:"Modifier la signature"})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("div",{className:"border rounded-lg bg-white",children:a.jsx(o(),{ref:t,canvasProps:{className:"signature-canvas w-full h-40"}})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2",children:[a.jsx("button",{onClick:()=>{t.current?.clear()},className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Effacer"}),a.jsx("button",{onClick:()=>{if(t.current?.isEmpty()){c.default.error("Veuillez signer avant de sauvegarder");return}let s=t.current?.toDataURL();s&&e&&(e(s),c.default.success("Signature enregistr\xe9e"))},className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700",children:"Sauvegarder"})]})]})})}c=(n.then?(await n)():n)[0],r()}catch(e){r(e)}})},377:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{Z:()=>u});var a=t(997),l=t(6689),i=t(5641),o=t(9008),c=t(3590),n=t(7318),d=t(1915),m=e([i,c,n,d]);function u({vehicle:e,onClose:s,onSuccess:t}){let[r,m]=(0,l.useState)(!1),[u,x]=(0,l.useState)(e?.client_signature||null),[h,p]=(0,l.useState)([]),[b,g]=(0,l.useState)(e?.mechanics?.map(e=>e.toString())||[]),[f,y]=(0,l.useState)([]),{register:j,handleSubmit:v,setValue:w,formState:{errors:N}}=(0,i.useForm)({defaultValues:{client_name:e?.client_name||"",address:e?.address||"",phone:e?.phone||"",brand_model:e?.brand_model||"",mileage:e?.mileage||void 0,work_type:e?.work_type||"",parts_supplies:e?.parts_supplies||"",entry_date:e?.entry_date||"",exit_date:e?.exit_date||"",observations:e?.observations||"",registration_number:e?.registration_number||"",status:e?.status||"pending",mechanics:[]}});(0,l.useEffect)(()=>{_(),y([,,,,].fill("").map((s,t)=>e?.photos?.[t]||"")),e&&Object.entries(e).forEach(([e,s])=>{"mechanics"!==e&&"photos"!==e&&"client_signature"!==e&&w(e,s)})},[e,w]);let _=async()=>{try{let{data:e,error:s}=await o.O.from("mechanics").select("id, name").order("name");if(s)throw s;console.log("Mechanics fetched:",e),p(e||[])}catch(e){console.error("Error fetching mechanics:",e),c.toast.error("Erreur lors du chargement des m\xe9caniciens")}},k=(e,s)=>{let t=[...f];t[e]=s,y(t)},C=async e=>{try{let s=f[e];if(s){let e=s.split("/").pop();if(e){let{error:s}=await o.O.storage.from("vehicle-photos").remove([e]);if(s)throw console.error("Error deleting photo from storage:",s),s}}let t=[...f];t[e]="",y(t)}catch(e){console.error("Error deleting photo:",e),c.toast.error("Erreur lors de la suppression de la photo")}},S=async s=>{try{m(!0);let r=b.map(e=>parseInt(e,10)),a={client_name:s.client_name,address:s.address,phone:s.phone,brand_model:s.brand_model,mileage:s.mileage,work_type:s.work_type,parts_supplies:s.parts_supplies,entry_date:s.entry_date,exit_date:s.exit_date,observations:s.observations,registration_number:s.registration_number,status:s.status,mechanics:r,client_signature:u,photos:f.filter(e=>e&&""!==e.trim())},l=Object.fromEntries(Object.entries(a).filter(([e,s])=>Array.isArray(s)?s.length>0:void 0!==s&&""!==s&&null!==s));u||(l.client_signature=null),f.every(e=>!e||""===e.trim())&&(l.photos=[]);let{data:i,error:n}=e?.id?await o.O.from("vehicles").update(l).eq("id",e.id):await o.O.from("vehicles").insert(l).select();if(n)throw console.error("Supabase error:",n),n;c.toast.success(e?"V\xe9hicule modifi\xe9 avec succ\xe8s":"V\xe9hicule ajout\xe9 avec succ\xe8s"),t()}catch(s){console.error("Error saving vehicle:",s),c.toast.error(e?"Erreur lors de la modification du v\xe9hicule":"Erreur lors de l'ajout du v\xe9hicule")}finally{m(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4",children:a.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4",children:e?"Modifier le v\xe9hicule":"Ajouter un v\xe9hicule"}),(0,a.jsxs)("form",{onSubmit:v(S),className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nom du client"}),a.jsx("input",{type:"text",...j("client_name",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),N.client_name&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.client_name.message})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Adresse"}),a.jsx("input",{type:"text",...j("address"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"T\xe9l\xe9phone"}),a.jsx("input",{type:"text",...j("phone",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),N.phone&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.phone.message})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Marque et Mod\xe8le"}),a.jsx("input",{type:"text",...j("brand_model",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),N.brand_model&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.brand_model.message})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Kilom\xe9trage"}),a.jsx("input",{type:"number",...j("mileage"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Immatriculation"}),a.jsx("input",{type:"text",...j("registration_number",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),N.registration_number&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.registration_number.message})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Type de travaux"}),a.jsx("input",{type:"text",...j("work_type",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),N.work_type&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.work_type.message})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Pi\xe8ces et fournitures"}),a.jsx("textarea",{...j("parts_supplies"),rows:3,className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date d'entr\xe9e"}),a.jsx("input",{type:"date",...j("entry_date",{required:"Ce champ est requis"}),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"}),N.entry_date&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:N.entry_date.message})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Date de sortie pr\xe9vue"}),a.jsx("input",{type:"date",...j("exit_date"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Statut"}),(0,a.jsxs)("select",{...j("status"),className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2",children:[a.jsx("option",{value:"pending",children:"En attente"}),a.jsx("option",{value:"in_progress",children:"En cours"}),a.jsx("option",{value:"done",children:"Termin\xe9"}),a.jsx("option",{value:"validated",children:"Valid\xe9"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"M\xe9caniciens"}),a.jsx("select",{multiple:!0,value:b,onChange:e=>{let s=Array.from(e.target.selectedOptions,e=>e.value);g(s)},className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2",size:4,children:h.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Maintenez Ctrl (ou Cmd sur Mac) pour s\xe9lectionner plusieurs m\xe9caniciens"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Observations"}),a.jsx("textarea",{...j("observations"),rows:3,className:"mt-1 block w-full rounded-md border-2 border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 focus:border-2"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Photos du v\xe9hicule"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:f.map((e,s)=>a.jsx(d.Z,{index:s,imageUrl:e,onUpload:e=>k(s,e),onDelete:()=>C(s)},`${s}-${e}`))}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Vous pouvez ajouter jusqu'\xe0 4 photos du v\xe9hicule"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Signature du client"}),a.jsx(n.Z,{existingSignature:u,onSave:e=>x(e)})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Annuler"}),a.jsx("button",{type:"submit",disabled:r,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:r?"Enregistrement...":e?"Modifier":"Ajouter"})]})]})]})})})}[i,c,n,d]=m.then?(await m)():m,r()}catch(e){r(e)}})},7553:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.d(s,{Z:()=>d});var a=t(997),l=t(6689),i=t(9008),o=t(3590),c=t(377),n=e([o,c]);function d(){let[e,s]=(0,l.useState)([]),[t,r]=(0,l.useState)(!0),[n,d]=(0,l.useState)(!1),[m,u]=(0,l.useState)(null),[x,h]=(0,l.useState)("");(0,l.useEffect)(()=>{p()},[]);let p=async()=>{try{let{data:e,error:t}=await i.O.from("vehicles").select("*").order("entry_date",{ascending:!1}).order("created_at",{ascending:!1}).order("id",{ascending:!1});if(t)throw t;let{data:r,error:a}=await i.O.from("mechanics").select("id, name");if(a)throw a;let l=new Map(r.map(e=>[e.id,e])),o=e.map(e=>({...e,mechanicsList:Array.isArray(e.mechanics)?e.mechanics.map(e=>l.get(e)?.name).filter(Boolean).join(", "):""}));s(o||[])}catch(e){console.error("Error fetching vehicles:",e),o.toast.error("Erreur lors du chargement des v\xe9hicules")}finally{r(!1)}},b=e.filter(e=>{let s=x.toLowerCase();return e.client_name?.toLowerCase().includes(s)||e.brand_model?.toLowerCase().includes(s)||e.registration_number?.toLowerCase().includes(s)||e.work_type?.toLowerCase().includes(s)}),g=e=>{u(e),d(!0)},f=async e=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer ce v\xe9hicule ?"))try{let{error:s}=await i.O.from("vehicles").delete().eq("id",e);if(s)throw s;o.toast.success("V\xe9hicule supprim\xe9 avec succ\xe8s"),p()}catch(e){console.error("Error deleting vehicle:",e),o.toast.error("Erreur lors de la suppression du v\xe9hicule")}},y=e=>{switch(e){case"pending":return"En attente";case"in_progress":return"En cours";case"done":return"Termin\xe9";case"validated":return"Valid\xe9";default:return e}},j=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"in_progress":return"bg-blue-100 text-blue-800";case"done":return"bg-green-100 text-green-800";case"validated":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return t?a.jsx("div",{children:"Chargement..."}):(0,a.jsxs)("div",{className:"px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"sm:flex sm:items-center",children:[(0,a.jsxs)("div",{className:"sm:flex-auto",children:[a.jsx("h1",{className:"text-base font-semibold leading-6 text-gray-900",children:"Fiches V\xe9hicules"}),a.jsx("p",{className:"mt-2 text-sm text-gray-700",children:"Liste des v\xe9hicules en r\xe9paration"})]}),a.jsx("div",{className:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none",children:a.jsx("button",{onClick:()=>{u(null),d(!0)},type:"button",className:"block rounded-md bg-blue-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600",children:"Ajouter une fiche"})})]}),a.jsx("div",{className:"mt-4",children:(0,a.jsxs)("div",{className:"relative rounded-md shadow-sm",children:[a.jsx("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Rechercher par nom, mod\xe8le, immatriculation...",className:"block w-full rounded-md border-gray-300 pl-4 pr-12 focus:border-blue-500 focus:ring-blue-500 sm:text-sm"}),a.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3",children:a.jsx("svg",{className:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})})]})}),a.jsx("div",{className:"mt-8 flow-root",children:a.jsx("div",{className:"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8",children:a.jsx("div",{className:"inline-block min-w-full py-2 align-middle",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-300",children:[a.jsx("thead",{children:(0,a.jsxs)("tr",{children:[a.jsx("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6 lg:pl-8",children:"Client"}),a.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"V\xe9hicule"}),a.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Immatriculation"}),a.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Statut"}),a.jsx("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"M\xe9caniciens"}),a.jsx("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6 lg:pr-8",children:a.jsx("span",{className:"sr-only",children:"Actions"})})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:t?a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"text-center py-4",children:"Chargement..."})}):0===b.length?a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:x?"Aucun v\xe9hicule ne correspond \xe0 votre recherche":"Aucun v\xe9hicule enregistr\xe9"})}):b.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[a.jsx("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6 lg:pl-8",children:e.client_name}),a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.brand_model}),a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.registration_number||"-"}),a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm",children:a.jsx("span",{className:`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ${j(e.status)}`,children:y(e.status)})}),a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.mechanicsList||"-"}),(0,a.jsxs)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6 lg:pr-8",children:[a.jsx("button",{onClick:()=>g(e),className:"text-blue-600 hover:text-blue-900 mr-4",children:"Modifier"}),a.jsx("button",{onClick:()=>f(e.id),className:"text-red-600 hover:text-red-900",children:"Supprimer"})]})]},e.id))})]})})})}),n&&a.jsx(c.Z,{vehicle:m,onClose:()=>d(!1),onSuccess:()=>{d(!1),p()}})]})}[o,c]=n.then?(await n)():n,r()}catch(e){r(e)}})}};