(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[798],{1993:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/secretary/vehicles",function(){return t(5674)}])},6530:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var n=t(5893),l=t(7294),r=t(1163),a=t(9008);function i(e){let{children:s,allowedRoles:t}=e,i=(0,r.useRouter)(),[c,o]=(0,l.useState)(!0);async function d(){try{let{data:{session:e}}=await a.O.auth.getSession();if(!e){i.push("/auth/login");return}if(t){let{data:s}=await a.O.from("users").select("role").eq("id",e.user.id).single();if(!s||!t.includes(s.role)){i.push("/");return}}}catch(e){console.error("Error checking auth:",e),i.push("/auth/login")}finally{o(!1)}}return((0,l.useEffect)(()=>{d()},[]),c)?(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):(0,n.jsx)(n.Fragment,{children:s})}},4645:function(e,s,t){"use strict";t.d(s,{Z:function(){return o}});var n=t(5893),l=t(7294),r=t(1163),a=t(9008),i=t(2920);function c(){return(0,n.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,n.jsx)("img",{src:"/images/mechanic-duck.png.png",alt:"M\xe9canicien",className:"w-48 h-48 object-contain",style:{maxWidth:"100%",height:"auto"}})})}function o(e){let{children:s,title:t}=e,o=(0,r.useRouter)(),[d,x]=(0,l.useState)(!1),[m,u]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{let{data:{user:e}}=await a.O.auth.getUser();if(e){let{data:s,error:t}=await a.O.from("users").select("full_name").eq("id",e.id).single();s&&s.full_name?u(s.full_name):u(e.email||null)}})()},[]);let h=async()=>{try{let{error:e}=await a.O.auth.signOut();if(e)throw e;o.push("/auth/login"),i.Am.success("D\xe9connexion r\xe9ussie")}catch(e){i.Am.error("Erreur lors de la d\xe9connexion"),console.error("Error:",e)}};return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,n.jsx)("div",{className:"fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ".concat(d?"translate-x-0":"-translate-x-full"," lg:translate-x-0 transition-transform duration-200 ease-in-out"),children:(0,n.jsxs)("div",{className:"flex flex-col h-full",children:[(0,n.jsx)("div",{className:"flex items-center justify-center h-16 px-4 bg-blue-600",children:(0,n.jsx)("h2",{className:"text-xl font-semibold text-white",children:"ProAutoServices"})}),(0,n.jsx)("div",{className:"px-4 py-3 bg-gray-50",children:(0,n.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Bonjour ",m]})}),(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(c,{})}),(0,n.jsx)("nav",{className:"flex-1 px-4 py-4 space-y-1"}),(0,n.jsx)("div",{className:"p-4 border-t",children:(0,n.jsx)("button",{onClick:h,className:"w-full px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"D\xe9connexion"})})]})}),(0,n.jsxs)("div",{className:"lg:pl-64",children:[(0,n.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between h-16 px-4 bg-white shadow-sm",children:[(0,n.jsx)("button",{onClick:()=>x(!d),className:"p-2 text-gray-500 lg:hidden",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,n.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:t}),(0,n.jsx)("div",{className:"w-6 lg:hidden"})," "]}),(0,n.jsx)("main",{className:"p-4",children:s})]})]})}},9008:function(e,s,t){"use strict";t.d(s,{O:function(){return n}});let n=(0,t(6490).eI)("https://pjxtjkmqgkbisgfleaps.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqeHRqa21xZ2tiaXNnZmxlYXBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYxOTAzMzAsImV4cCI6MjA1MTc2NjMzMH0.UjKK4kSJDapIRx0iJvdHiJZzMbi99tDx52FmSq4qyfE",{auth:{persistSession:!0,autoRefreshToken:!0}})},5674:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return x}});var n=t(5893),l=t(7294),r=t(9008),a=t(1664),i=t.n(a),c=t(6501),o=t(4645),d=t(6530);function x(){let[e,s]=(0,l.useState)([]),[t,a]=(0,l.useState)(!0);(0,l.useEffect)(()=>{x()},[]);let x=async()=>{try{let{data:e,error:t}=await r.O.from("vehicles").select("\n          *,\n          mechanic:users(full_name)\n        ").order("entry_date",{ascending:!1});if(t){console.error("Error fetching vehicles:",t),c.Am.error("Erreur lors du chargement des v\xe9hicules");return}s(e||[])}catch(e){console.error("Error:",e),c.Am.error("Erreur lors du chargement des v\xe9hicules")}finally{a(!1)}};return t?(0,n.jsx)("div",{children:"Chargement..."}):(0,n.jsx)(d.Z,{allowedRoles:["secretary"],children:(0,n.jsx)(o.Z,{title:"Liste des v\xe9hicules",children:(0,n.jsx)("div",{className:"py-6",children:(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,n.jsxs)("div",{className:"sm:flex sm:items-center",children:[(0,n.jsxs)("div",{className:"sm:flex-auto",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"V\xe9hicules"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-gray-700",children:"Liste de tous les v\xe9hicules en r\xe9paration"})]}),(0,n.jsx)("div",{className:"mt-4 sm:mt-0 sm:ml-16 sm:flex-none",children:(0,n.jsx)(i(),{href:"/vehicles/new",className:"inline-flex items-center justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:w-auto",children:"Ajouter un v\xe9hicule"})})]}),(0,n.jsx)("div",{className:"mt-8 flex flex-col",children:(0,n.jsx)("div",{className:"-my-2 -mx-4 overflow-x-auto sm:-mx-6 lg:-mx-8",children:(0,n.jsx)("div",{className:"inline-block min-w-full py-2 align-middle md:px-6 lg:px-8",children:(0,n.jsx)("div",{className:"overflow-hidden shadow ring-1 ring-black ring-opacity-5 md:rounded-lg",children:(0,n.jsxs)("table",{className:"min-w-full divide-y divide-gray-300",children:[(0,n.jsx)("thead",{className:"bg-gray-50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{scope:"col",className:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6",children:"Client"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"V\xe9hicule"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Date d'entr\xe9e"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Date de sortie"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"Statut"}),(0,n.jsx)("th",{scope:"col",className:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900",children:"M\xe9canicien"}),(0,n.jsx)("th",{scope:"col",className:"relative py-3.5 pl-3 pr-4 sm:pr-6",children:(0,n.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:e.map(e=>{var s;return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6",children:e.client_name}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:e.brand_model}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:new Date(e.entry_date).toLocaleDateString()}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:new Date(e.exit_date).toLocaleDateString()}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:(0,n.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \n                                ".concat("pending"===e.status?"bg-yellow-100 text-yellow-800":"in_progress"===e.status?"bg-blue-100 text-blue-800":"done"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:"pending"===e.status?"En attente":"in_progress"===e.status?"En cours":"done"===e.status?"Termin\xe9":"validated"===e.status?"Valid\xe9":e.status})}),(0,n.jsx)("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-500",children:(null===(s=e.mechanic)||void 0===s?void 0:s.full_name)||"-"}),(0,n.jsx)("td",{className:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6",children:(0,n.jsxs)(i(),{href:"/vehicles/".concat(e.id),className:"text-blue-600 hover:text-blue-900",children:["Voir",(0,n.jsxs)("span",{className:"sr-only",children:[", ",e.client_name]})]})})]},e.id)})})]})})})})})]})})})})}}},function(e){e.O(0,[574,719,774,888,179],function(){return e(e.s=1993)}),_N_E=e.O()}]);