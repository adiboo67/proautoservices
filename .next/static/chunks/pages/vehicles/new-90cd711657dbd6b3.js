(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{1704:function(e,s,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/vehicles/new",function(){return r(1029)}])},6530:function(e,s,r){"use strict";r.d(s,{Z:function(){return i}});var t=r(5893),l=r(7294),n=r(1163),o=r(9008);function i(e){let{children:s,allowedRoles:r}=e,i=(0,n.useRouter)(),[a,c]=(0,l.useState)(!0);async function d(){try{let{data:{session:e}}=await o.O.auth.getSession();if(!e){i.push("/auth/login");return}if(r){let{data:s}=await o.O.from("users").select("role").eq("id",e.user.id).single();if(!s||!r.includes(s.role)){i.push("/");return}}}catch(e){console.error("Error checking auth:",e),i.push("/auth/login")}finally{c(!1)}}return((0,l.useEffect)(()=>{d()},[]),a)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})}):(0,t.jsx)(t.Fragment,{children:s})}},4645:function(e,s,r){"use strict";r.d(s,{Z:function(){return c}});var t=r(5893),l=r(7294),n=r(1163),o=r(9008),i=r(2920);function a(){return(0,t.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,t.jsx)("img",{src:"/images/mechanic-duck.png.png",alt:"M\xe9canicien",className:"w-48 h-48 object-contain",style:{maxWidth:"100%",height:"auto"}})})}function c(e){let{children:s,title:r}=e,c=(0,n.useRouter)(),[d,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{let{data:{user:e}}=await o.O.auth.getUser();if(e){let{data:s,error:r}=await o.O.from("users").select("full_name").eq("id",e.id).single();s&&s.full_name?h(s.full_name):h(e.email||null)}})()},[]);let x=async()=>{try{let{error:e}=await o.O.auth.signOut();if(e)throw e;c.push("/auth/login"),i.Am.success("D\xe9connexion r\xe9ussie")}catch(e){i.Am.error("Erreur lors de la d\xe9connexion"),console.error("Error:",e)}};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,t.jsx)("div",{className:"fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ".concat(d?"translate-x-0":"-translate-x-full"," lg:translate-x-0 transition-transform duration-200 ease-in-out"),children:(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[(0,t.jsx)("div",{className:"flex items-center justify-center h-16 px-4 bg-blue-600",children:(0,t.jsx)("h2",{className:"text-xl font-semibold text-white",children:"ProAutoServices"})}),(0,t.jsx)("div",{className:"px-4 py-3 bg-gray-50",children:(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Bonjour ",m]})}),(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(a,{})}),(0,t.jsx)("nav",{className:"flex-1 px-4 py-4 space-y-1"}),(0,t.jsx)("div",{className:"p-4 border-t",children:(0,t.jsx)("button",{onClick:x,className:"w-full px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:"D\xe9connexion"})})]})}),(0,t.jsxs)("div",{className:"lg:pl-64",children:[(0,t.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between h-16 px-4 bg-white shadow-sm",children:[(0,t.jsx)("button",{onClick:()=>u(!d),className:"p-2 text-gray-500 lg:hidden",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,t.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:r}),(0,t.jsx)("div",{className:"w-6 lg:hidden"})," "]}),(0,t.jsx)("main",{className:"p-4",children:s})]})]})}},1915:function(e,s,r){"use strict";r.d(s,{Z:function(){return c}});var t=r(5893),l=r(7294),n=r(5675),o=r.n(n),i=r(9008),a=r(2920);function c(e){let{imageUrl:s,onUpload:r,onDelete:n,index:c}=e,[d,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{s&&h(null)},[s]);let x=async e=>{try{var s;if(u(!0),!e.target.files||0===e.target.files.length)throw Error("Veuillez s\xe9lectionner une image");let t=e.target.files[0],l=(null===(s=t.name.split(".").pop())||void 0===s?void 0:s.toLowerCase())||"";if(!["jpg","jpeg","png","gif"].includes(l))throw Error("Format de fichier non support\xe9. Utilisez JPG, PNG ou GIF");if(t.size>5242880)throw Error("La taille du fichier ne doit pas d\xe9passer 5MB");let n="".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9),".").concat(l),o=new FileReader;o.onloadend=()=>{h(o.result)},o.readAsDataURL(t);let{error:a,data:c}=await i.O.storage.from("vehicle-photos").upload(n,t,{cacheControl:"3600",upsert:!1,contentType:"image/".concat("jpg"===l?"jpeg":l)});if(a)throw console.error("Upload error details:",a),Error(a.message);if(null==c?void 0:c.path){let{data:e}=i.O.storage.from("vehicle-photos").getPublicUrl(n);if(null==e?void 0:e.publicUrl)r(e.publicUrl);else throw Error("Erreur lors de la r\xe9cup\xe9ration de l'URL publique")}else throw Error("Erreur lors du t\xe9l\xe9chargement du fichier")}catch(e){console.error("Upload error:",e),a.Am.error(e.message||"Erreur lors du t\xe9l\xe9chargement"),h(null)}finally{u(!1)}},p=async()=>{if(n)try{if(s){let e=s.split("/").pop();if(e){let{error:s}=await i.O.storage.from("vehicle-photos").remove([e]);if(s)throw console.error("Error deleting file:",s),Error("Erreur lors de la suppression du fichier")}}h(null),n()}catch(e){console.error("Error in handleDelete:",e),a.Am.error(e.message||"Erreur lors de la suppression de l'image")}},f=s||m;return(0,t.jsx)("div",{className:"relative w-full h-40 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300 hover:border-gray-400 transition-colors",children:f?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o(),{src:f,alt:"Photo ".concat(c+1),fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-contain p-2 rounded-lg",unoptimized:null!==m,priority:0===c}),(0,t.jsx)("button",{onClick:p,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md hover:bg-red-600 transition-colors z-10",type:"button",title:"Supprimer la photo",children:"\xd7"})]}):(0,t.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-full cursor-pointer",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[(0,t.jsx)("svg",{className:"w-8 h-8 mb-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Photo ",c+1]}),d&&(0,t.jsx)("div",{className:"mt-2 text-sm text-blue-500",children:"Chargement..."})]}),(0,t.jsx)("input",{type:"file",className:"hidden",accept:"image/jpeg,image/png,image/gif",onChange:x,disabled:d})]})})}},9008:function(e,s,r){"use strict";r.d(s,{O:function(){return t}});let t=(0,r(6490).eI)("https://pjxtjkmqgkbisgfleaps.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBqeHRqa21xZ2tiaXNnZmxlYXBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzYxOTAzMzAsImV4cCI6MjA1MTc2NjMzMH0.UjKK4kSJDapIRx0iJvdHiJZzMbi99tDx52FmSq4qyfE",{auth:{persistSession:!0,autoRefreshToken:!0}})},1029:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return m}});var t=r(5893),l=r(7294),n=r(1163),o=r(7536),i=r(9008),a=r(2920),c=r(4645),d=r(6530),u=r(1915);function m(){let[e,s]=(0,l.useState)(!1),[r,m]=(0,l.useState)(["","","",""]),h=(0,n.useRouter)(),{client_name:x,phone:p,brand_model:f,work_type:g,entry_date:b}=h.query,{register:j,handleSubmit:y,formState:{errors:w}}=(0,o.cI)({defaultValues:{client_name:x||"",phone:p||"",brand_model:f||"",work_type:g||"",entry_date:b||new Date().toISOString().split("T")[0],status:"En attente",parts_supplies:""}}),N=(e,s)=>{let t=[...r];t[e]=s,m(t)},v=e=>{let s=[...r];s[e]="",m(s)},k=async e=>{try{s(!0);let{data:t}=await i.O.auth.getUser();if(!t.user)throw Error("Non authentifi\xe9");let l={...e,photos:r.filter(Boolean),created_by:t.user.id,updated_by:t.user.id},{error:n}=await i.O.from("vehicles").insert([l]);if(n)throw n;a.Am.success("V\xe9hicule cr\xe9\xe9 avec succ\xe8s"),h.push("/vehicles")}catch(e){console.error("Error creating vehicle:",e),a.Am.error("Erreur lors de la cr\xe9ation du v\xe9hicule")}finally{s(!1)}};return(0,t.jsx)(d.Z,{allowedRoles:["secretary"],children:(0,t.jsx)(c.Z,{title:"Nouveau v\xe9hicule",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,t.jsx)("div",{className:"px-4 py-6 sm:px-0",children:(0,t.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold text-gray-900 mb-6",children:"Nouveau v\xe9hicule"}),(0,t.jsxs)("form",{onSubmit:y(k),className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"client_name",className:"block text-sm font-medium text-gray-700",children:"Nom du client"}),(0,t.jsx)("input",{type:"text",id:"client_name",...j("client_name",{required:!0}),className:"mt-1 block w-full border-2 border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),w.client_name&&(0,t.jsx)("span",{className:"text-red-500 text-sm",children:"Ce champ est requis"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"T\xe9l\xe9phone"}),(0,t.jsx)("input",{type:"tel",id:"phone",...j("phone",{required:!0}),className:"mt-1 block w-full border-2 border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),w.phone&&(0,t.jsx)("span",{className:"text-red-500 text-sm",children:"Ce champ est requis"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"brand_model",className:"block text-sm font-medium text-gray-700",children:"Marque et mod\xe8le"}),(0,t.jsx)("input",{type:"text",id:"brand_model",...j("brand_model",{required:!0}),className:"mt-1 block w-full border-2 border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),w.brand_model&&(0,t.jsx)("span",{className:"text-red-500 text-sm",children:"Ce champ est requis"})]}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("label",{htmlFor:"work_type",className:"block text-sm font-medium text-gray-700",children:"Type de travaux"}),(0,t.jsx)("textarea",{id:"work_type",rows:8,...j("work_type",{required:!0}),className:"mt-1 block w-full border-2 border-gray-300 rounded-md shadow-sm py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm min-h-[200px]"}),w.work_type&&(0,t.jsx)("span",{className:"text-red-500 text-sm",children:"Ce champ est requis"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"entry_date",className:"block text-sm font-medium text-gray-700",children:"Date d'entr\xe9e"}),(0,t.jsx)("input",{type:"date",id:"entry_date",...j("entry_date",{required:!0}),className:"mt-1 block w-full border-2 border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),w.entry_date&&(0,t.jsx)("span",{className:"text-red-500 text-sm",children:"Ce champ est requis"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700",children:"Statut"}),(0,t.jsxs)("select",{id:"status",...j("status",{required:!0}),className:"mt-1 block w-full border-2 border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:[(0,t.jsx)("option",{value:"En attente",children:"En attente"}),(0,t.jsx)("option",{value:"En cours",children:"En cours"}),(0,t.jsx)("option",{value:"Termin\xe9",children:"Termin\xe9"})]}),w.status&&(0,t.jsx)("span",{className:"text-red-500 text-sm",children:"Ce champ est requis"})]}),(0,t.jsxs)("div",{className:"sm:col-span-2",children:[(0,t.jsx)("label",{htmlFor:"parts_supplies",className:"block text-sm font-medium text-gray-700",children:"Pi\xe8ces et fournitures"}),(0,t.jsx)("textarea",{id:"parts_supplies",rows:8,...j("parts_supplies"),className:"mt-1 block w-full border-2 border-gray-300 rounded-md shadow-sm py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm min-h-[200px]"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Photos du v\xe9hicule"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:r.map((e,s)=>(0,t.jsx)(u.Z,{index:s,imageUrl:e,onUpload:e=>N(s,e),onDelete:()=>v(s)},s))})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:()=>h.push("/vehicles"),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Annuler"}),(0,t.jsx)("button",{type:"submit",disabled:e,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:e?"Cr\xe9ation...":"Cr\xe9er"})]})]})]})})})})})}}},function(e){e.O(0,[574,536,675,774,888,179],function(){return e(e.s=1704)}),_N_E=e.O()}]);